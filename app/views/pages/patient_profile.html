<!DOCTYPE html>
<html>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/stylesheets/main.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      if((window.location.href).indexOf('?') != -1) {
        var queryString = (window.location.href).substr((window.location.href).indexOf('?') + 1);
        var careCardNo = (queryString.split('='))[1];
        var myQuery = "SELECT * FROM Patient NATURAL JOIN Prescription WHERE careCardNo='" + careCardNo + "'";
        execute(myQuery);
        var myHistoryQuery = "SELECT * FROM DrugIntakeEvent WHERE careCardNo='" + careCardNo + "'";
        executeHistory(myHistoryQuery);
      }
    });

    function execute(querystring) {
      $.ajax({
          url : "/makequery?q=" + querystring,
          type : "GET",
          async : false,
          dataType: "json",
          success: function(data)  {
          for (var i = 0; i < data.length; i++) {
    	      var curr = data[i]
            $("#ccn").append("<td>" + curr.careCardNo + "</td>");
            $("#fname").append("<td>" + curr.p_fname + "</td>");
            $("#lname").append("<td>" + curr.p_lname + "</td>");
            $("#cond").append("<td>" + curr.p_condition + "</td>");
            $("#pnum").append("<td>" + curr.phone_number + "</td>");
            $("#bnum").append("<td>" + curr.bID + "</td>");
            // $("#rnum").append("<td>" + curr.roomID + "</td>");

            var prescriptString = "<tr><td>" + JSON.stringify(curr.mname) + "</td><td>" +
            JSON.stringify(curr.p_date) + "</td><td>" + JSON.stringify(curr.p_interval) +
            "</td><td>" + JSON.stringify(curr.p_dosage) + "</td><td>" + JSON.stringify(curr.last_taken) +
            "</td><td>" + JSON.stringify(curr.last_taken) + "</td></tr>";

            $("#prescription-info").append(prescriptString);
          }
        }
        })
    }

    function executeHistory(querystring) {
      $.ajax({
          url : "/makequery?q=" + querystring,
          type : "GET",
          async : false,
          dataType: "json",
          success: function(data)  {
          var dosageArray = [];
          for (var i = 0; i < data.length; i++) {
    	      var curr = data[i]
            dosageArray.push(curr.d_dosage);
            var drugintakeString = "<tr><td>" + JSON.stringify(curr.mname) + "</td><td>" +
            JSON.stringify(curr.di_date) + "</td><td>" + JSON.stringify(curr.eID) +
            "</td><td>" + JSON.stringify(curr.d_dosage) + "</td></tr>";

            $("#intake-history").append(drugintakeString);
          }
          //printRadio(dosageArray);
        }
        })
    }

    function printRadio(dosageArray) {
      $('input[name=dosageopt]:checked').val();
      for (var i = 0; i < dosageArray.length; i++) {

      }
    }

    function getNextDose(lastTaken, interval) {

    }
  </script>
<body>

<h4>Basic Information:</h4>
<table id="basic-info">
  <tr>
    <td id="ccn">Care Card Number:</td>

  </tr>
  <tr>
    <td id="fname">First Name:</td>

  </tr>
  <tr>
    <td id="lname">Last Name:</td>

  </tr>
  <tr>
    <td id="cond">Condition:</td>

  </tr>
  <tr>
    <td id="pnum">Phone Number:</td>

  </tr>
</table>

<h4>Bed:</h4>
<table id="bed-info">
  <tr>
    <td id="bnum">Bed:</td>

  </tr>
  <tr>
    <td id="rnum">Room:</td>

  </tr>
</table>

<h4>Prescriptions:</h4>
<table>
  <thead>
    <tr>
      <th>Medication</th>
      <th>Date Issued</th>
      <th>Interval (hours)</th>
      <th>Dosage (mg)</th>
      <th>Last Taken</th>
      <th>Next Dose</th>
    </tr>
  </thead>
  <tbody id="prescription-info">

  </tbody>
</table>

<h4>Drug Intake History:</h4>
<table>
  <thead>
    <tr>
      <th>Medication</th>
      <th>Taken On</th>
      <th>Nurse</th>
      <th>Dosage (mg)</th>
    </tr>
  </thead>
  <tbody id="intake-history">

  </tbody>
</table>

<h4>Dosage Options:</h4>
<form action="javascript:printRadio()">
  <input type="radio" name="dosageopt" value="none" checked>None<br>
  <input type="radio" name="dosageopt" value="min">Min<br>
  <input type="radio" name="dosageopt" value="max">Max<br>
  <input type="radio" name="dosageopt" value="avg">Average<br>
  <input type="submit" value="Submit" class="button">
</form>
</body>
</html>
